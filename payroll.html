<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙƒØ´Ù Ø§Ù„Ø±ÙˆØ§ØªØ¨</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* (Ø§Ø­ØªÙØ¸ Ø¨Ø¬Ù…ÙŠØ¹ Ø£ÙƒÙˆØ§Ø¯ CSS ÙƒÙ…Ø§ Ù‡ÙŠ) */
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #2a5298, #1e3c72);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(5px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        h1 { 
            text-align: center; 
            font-size: 32px; 
            margin-bottom: 30px; 
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            color: #FFC107; 
        }

        /* Input Controls */
        .controls {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 10px;
            color: #333;
            margin-bottom: 25px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .controls select, .controls input {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-family: 'Cairo', sans-serif;
        }
        .controls button {
            grid-column: span 2;
            background: #2196f3; 
            color: white;
            font-weight: bold;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        .controls button:hover { background: #1976D2; }

        /* Salary Slip Style (Output) */
        #slip-output {
            background: #fff;
            color: #333;
            padding: 30px;
            border-radius: 10px;
            min-height: 300px;
            border: 2px dashed #FFC107;
        }
        .slip-header {
            text-align: center;
            border-bottom: 3px solid #333;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        .slip-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
            font-size: 15px;
        }
        .slip-details strong { font-size: 16px; }

        /* Summary Table */
        .summary-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .summary-table th, .summary-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: right;
        }
        .summary-table th { background: #f2f2f2; }
        .total-row td {
            background: #FFECB3;
            font-weight: bold;
            color: #e65100;
        }
        .net-salary-row td {
             background: #C8E6C9; 
             font-weight: bold;
             color: #388E3C;
        }

        /* Signature Area */
        .signature-area {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 15px;
            border-top: 1px solid #ddd;
            text-align: center;
        }
        .signature-box {
            width: 45%;
            border-bottom: 1px solid #333;
            padding: 20px 0 5px;
            font-size: 14px;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .action-buttons button {
            flex: 1;
            padding: 12px;
            font-weight: bold;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: 0.3s;
        }
        .btn-print { background: #4CAF50; color: white; }
        .btn-save { background: #F44336; color: white; } /* ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆÙ† Ù„ØªÙ…ÙŠÙŠØ² Ø²Ø± Ø§Ù„ØªÙ†Ø²ÙŠÙ„/Ø§Ù„Ø¯ÙØ¹ */
        
        #teacherSelect option[style*="color: rgb(244, 67, 54)"] {
             font-weight: bold;
        }
        
        /* Media Query for Print */
        @media print {
            body { background: #fff !important; color: #000 !important; padding: 0; }
            .container { 
                box-shadow: none !important; 
                border: none !important;
                background: #fff !important;
                max-width: none;
                margin: 0;
                padding: 20px;
            }
            .controls, .action-buttons, button[onclick*="window.location.href"] {
                display: none !important;
            }
            #slip-output {
                border: 1px solid #000;
                min-height: auto;
            }
            /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±Ø£Ø³ ÙˆØ§Ù„ØªØ°ÙŠÙŠÙ„ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© */
            @page { margin: 0; }
            .slip-header, .summary-table { break-inside: avoid; }
        }
    </style>
</head>
<body onload="loadTeachersAndSettings()">

    <div class="container">
        <h1>ğŸ’µ ÙƒØ´Ù Ø±ÙˆØ§ØªØ¨ Ø§Ù„Ø£Ø³ØªØ§Ø°</h1>
        
        <div class="controls">
            <select id="teacherSelect" required>
                <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø£Ø³ØªØ§Ø° --</option>
            </select>
            <input type="number" id="teacherShare" placeholder="Ù†Ø³Ø¨Ø© Ø§Ù„Ø£Ø³ØªØ§Ø° (%)" required>
            
            <input type="date" id="startDate" style="display: none;">
            <input type="date" id="endDate" style="display: none;">
            
            <p id="period-info" style="grid-column: span 2; font-weight: bold; margin: 0; color: #333; text-align: center; background: #e0e0e0; padding: 10px; border-radius: 5px;">
                Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø£Ø³ØªØ§Ø° Ù„ØªØ­Ø¯ÙŠØ¯ ÙØªØ±Ø© Ø§Ù„Ø¯ÙØ¹ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.
            </p>
            
            <button onclick="generateSalarySlip()">ØªÙˆÙ„ÙŠØ¯ ÙƒØ´Ù Ø§Ù„Ø±Ø§ØªØ¨</button>
        </div>
        
        <p style="text-align:center; color:#FFEB3B; margin-bottom: 15px; font-weight: bold;">
            *Ù…Ù„Ø§Ø­Ø¸Ø©: Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø¬Ø± ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ¯ "Ø³Ø¹Ø± Ø§Ù„Ø­ØµØ© Ø§Ù„ÙˆØ§Ø­Ø¯Ø©" Ù„Ù„Ø£Ø³ØªØ§Ø° ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©.
        </p>

        <div id="slip-output">
             <p style="text-align: center; color: #777;">ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ø³ØªØ§Ø° ÙˆØ§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ù„ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒØ´Ù.</p>
        </div>
        
        <div class="action-buttons" id="slip-actions" style="display: none;">
            <button class="btn-print" onclick="printSlip()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
            <button class="btn-save" onclick="saveAndDownloadSlip()">ğŸ’¾ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹ ÙˆØªÙ†Ø²ÙŠÙ„ Ø§Ù„ÙƒØ´Ù</button>
        </div>

        <button onclick="window.location.href='home.html'" style="background: #607D8B; margin-top: 20px;">
            Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        </button>

    </div>

    <script>
        let db;
        const DB_NAME = "AttendanceSystemDB";
        const DB_VERSION = 4; // ÙŠØ¬Ø¨ Ø£Ù† ØªØªØ·Ø§Ø¨Ù‚ Ù…Ø¹ Ø§Ù„Ø¥ØµØ¯Ø§Ø± ÙÙŠ stu.html
        let schoolName = "Ø§Ù„Ù…Ø¯Ø±Ø³Ø©"; 
        let managerName = "Ø§Ù„Ù…Ø¯ÙŠØ±"; 
        let generatedSlipData = null; 

        // --- IndexedDB Connection Functions ---

        async function connectDB(dbName, version) {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(dbName, version);
                
                request.onsuccess = e => resolve(e.target.result);
                
                // ØªØ­Ø³ÙŠÙ† Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
                request.onerror = e => {
                    const error = e.target.error;
                    console.error(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ IndexedDB (${dbName}):`, error);
                    reject(new DOMException(`ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ ${dbName}. Ø®Ø·Ø£: ${error.name}`));
                };
                
                // ** Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ ÙŠØ¶Ù…Ù† Ø¥Ù†Ø´Ø§Ø¡ Ù…ØªØ¬Ø± salaries Ùˆ users Ø¹Ù†Ø¯ Ø§Ù„ØªØ±Ù‚ÙŠØ© **
                request.onupgradeneeded = e => {
                    const db = e.target.result;
                    // 1. Ù…ØªØ¬Ø± Ø§Ù„Ø±ÙˆØ§ØªØ¨ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© AttendanceSystemDB
                    if(dbName === "AttendanceSystemDB" && !db.objectStoreNames.contains("salaries")) {
                         db.createObjectStore("salaries", { keyPath: "id", autoIncrement: true });
                         console.log("Salaries store created in AttendanceSystemDB.");
                    }
                    // 2. Ù…ØªØ¬Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© sectionsManagerDB
                    if(dbName === "sectionsManagerDB" && !db.objectStoreNames.contains("users")) {
                         // ÙŠØ¬Ø¨ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¥ØµØ¯Ø§Ø± 3 Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù…ØªØ¬Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                         db.createObjectStore("users", { autoIncrement: true }); 
                         console.log("Users store created in sectionsManagerDB.");
                    }
                    // Ù…Ù„Ø§Ø­Ø¸Ø©: Ù…ØªØ¬Ø± 'teachers' ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ ÙÙŠ Ù…Ù„Ù Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ (stu.html)
                };
            });
        }
        
        // --- Helper Function: Get Last Payment Date ---
        
        async function getLastPaymentDate(teacherId) {
            // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ db
            if (!db) return null;
            
            return new Promise(resolve => {
                // ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…ØªØ¬Ø± salaries
                if (!db.objectStoreNames.contains("salaries")) {
                    console.warn("Ù…ØªØ¬Ø± 'salaries' ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯. Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¬Ù„Ø¨ ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©.");
                    return resolve(null);
                }
                
                const tx = db.transaction("salaries", "readonly");
                const store = tx.objectStore("salaries");
                
                const request = store.getAll();
                request.onsuccess = e => {
                    const salaries = e.target.result
                        .filter(s => s.teacherId == teacherId);

                    if (salaries.length > 0) {
                        // Ø§Ù„ÙØ±Ø² Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø­Ø¯Ø«
                        salaries.sort((a, b) => new Date(b.paymentDate) - new Date(a.paymentDate));

                        // Ù†Ø£Ø®Ø° ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹ ÙˆÙ†Ø¶ÙŠÙ ÙŠÙˆÙ…Ø§Ù‹ Ù„ÙŠØ¨Ø¯Ø£ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ø¹Ø¯Ù‡
                        const lastPayment = new Date(salaries[0].paymentDate);
                        lastPayment.setDate(lastPayment.getDate() + 1); 
                        resolve(lastPayment); // Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ Ù„Ø¢Ø®Ø± Ø¯ÙØ¹
                    } else {
                        resolve(null); // Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¯ÙØ¹ Ø³Ø§Ø¨Ù‚
                    }
                };
                request.onerror = () => {
                     console.error("ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©.");
                     resolve(null);
                };
            });
        }

        // --- Initialization and Data Loading ---
        
        async function loadTeachersAndSettings() {
            try {
                // 1. Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ±
                db = await connectDB(DB_NAME, DB_VERSION);
                
                // 1.1 Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…ØªØ¬Ø± 'teachers' (Ø§Ù„Ù…ÙØªØ§Ø­ Ù„Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª)
                if (!db.objectStoreNames.contains("teachers")) {
                    document.getElementById("slip-output").innerHTML = `<p style="text-align: center; color: #F44336; font-weight: bold;">âš ï¸ Ø®Ø·Ø£: Ù…ØªØ¬Ø± 'teachers' ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ù…Ù„Ù Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ (stu.html) Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£Ø³Ø§ØªØ°Ø© Ø£ÙˆÙ„Ø§Ù‹.</p>`;
                    throw new Error("Ù…ØªØ¬Ø± 'teachers' ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.");
                }

                // 2. Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø³Ø§ØªØ°Ø© Ù„Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
                const tx = db.transaction("teachers", "readonly");
                const teachers = await new Promise(resolve => {
                    tx.objectStore("teachers").getAll().onsuccess = e => resolve(e.target.result);
                });

                const select = document.getElementById("teacherSelect");
                
                // Ø¬Ù„Ø¨ ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹ Ø¨Ø§Ù„ØªÙˆØ§Ø²ÙŠ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡
                const teacherPromises = teachers.map(async t => {
                    const lastPaymentDate = await getLastPaymentDate(t.id);
                    const today = new Date();
                    const calculationStartDate = lastPaymentDate || new Date('2000-01-01');

                    const diffTime = Math.abs(today - calculationStartDate);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    return { t, diffDays, lastPaymentDate };
                });
                
                const teachersWithStatus = await Promise.all(teacherPromises);


                for (const { t, diffDays, lastPaymentDate } of teachersWithStatus) {
                    const option = document.createElement("option");
                    option.value = t.id;
                    option.textContent = `${t.name} - ${t.subject} (Ø³Ø¹Ø± Ø§Ù„Ø­ØµØ©: ${t.pricePerClass || 0})`;
                    option.dataset.teacher = JSON.stringify(t); 
                    
                    // --- Ù…Ù†Ø·Ù‚ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø± (ØªÙ… Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ù‡ ÙƒØªØ­Ø°ÙŠØ±) ---
                    if (diffDays >= 30) {
                        option.style.color = '#F44336'; // Ø£Ø­Ù…Ø±
                        option.textContent += ' âš ï¸ (Ø­Ø§Ù† Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø¯ÙØ¹/Ù…Ø± Ø´Ù‡Ø±)';
                    }
                    
                    select.appendChild(option);
                }

                // 3. Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ± ÙˆØ§Ù„Ù…Ø¯Ø±Ø³Ø© (Ø¬Ø¹Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ø®ØªÙŠØ§Ø±ÙŠØ§Ù‹)
                try {
                    const managerDB = await connectDB("sectionsManagerDB", 3);
                    
                    if (managerDB.objectStoreNames.contains("users")) {
                         const managerTx = managerDB.transaction("users", "readonly");
                         const users = await new Promise(resolve => {
                             managerTx.objectStore("users").getAll().onsuccess = e => resolve(e.target.result);
                         });
                         
                         if (users.length > 0) {
                             schoolName = users[0].school || "Ø§Ù„Ù…Ø¯Ø±Ø³Ø©";
                             managerName = users[0].manager || "Ø§Ù„Ù…Ø¯ÙŠØ±";
                         }
                    } else {
                         console.warn("Ù…ØªØ¬Ø± 'users' ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ sectionsManagerDB. Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©.");
                    }
                } catch(managerError) {
                     console.warn("ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ sectionsManagerDBØŒ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©.", managerError);
                }
                
                // Ø£Ø¶Ù Ù…Ø³ØªÙ…Ø¹ Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØªØ±Ø© Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø£Ø³ØªØ§Ø°
                select.addEventListener('change', updatePeriodInfo);
                
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ:", error);
                // ØªØ­Ø¯ÙŠØ« Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
                if (!error.message.includes("teachers")) {
                    alert(`ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§ØªØ°Ø© ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¹Ø¨Ø± Ø®Ø§Ø¯Ù… ÙˆÙŠØ¨ (HTTP). Ø®Ø·Ø£: ${error.message}`);
                }
            }
        }
        
        async function updatePeriodInfo() {
            const selectElement = document.getElementById("teacherSelect");
            const teacherId = selectElement.value;
            const periodInfo = document.getElementById("period-info");
            
            if (!teacherId) {
                periodInfo.textContent = "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø£Ø³ØªØ§Ø° Ù„ØªØ­Ø¯ÙŠØ¯ ÙØªØ±Ø© Ø§Ù„Ø¯ÙØ¹ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.";
                return;
            }
            
            // Ù…Ù„Ø§Ø­Ø¸Ø©: Ù†ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† db Ù…ÙˆØ¬ÙˆØ¯ Ù‚Ø¨Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ getLastPaymentDate
            if (!db) {
                 periodInfo.textContent = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙØªØ±Ø©.";
                 return;
            }
            
            const lastPaymentDate = await getLastPaymentDate(teacherId);
            const endDate = new Date(); 
            let startDate;

            if (lastPaymentDate) {
                startDate = lastPaymentDate;
            } else {
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙˆØ¬Ø¯ Ø¯ÙØ¹ Ø³Ø§Ø¨Ù‚ØŒ Ù†Ø¨Ø¯Ø£ Ù…Ù† Ø¨Ø¯Ø§ÙŠØ© ØªØ§Ø±ÙŠØ® Ø§ÙØªØ±Ø§Ø¶ÙŠ
                startDate = new Date('2000-01-01'); 
            }
            
            // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù„Ù„Ø¹Ø±Ø¶
            const startDisplay = startDate.toLocaleDateString('ar-DZ', { year: 'numeric', month: 'numeric', day: 'numeric' });
            const endDisplay = endDate.toLocaleDateString('ar-DZ', { year: 'numeric', month: 'numeric', day: 'numeric' });
            
            periodInfo.textContent = `ÙØªØ±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨: Ù…Ù† ${startDisplay} Ø¥Ù„Ù‰ ${endDisplay}`;
            
            // ØªØ®Ø²ÙŠÙ† Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® ÙÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø®ÙÙŠØ© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ generateSalarySlip
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… toISOString().substring(0, 10) Ù„ØªØ¹Ø¨Ø¦Ø© Ø­Ù‚Ù„ input type="date"
            document.getElementById("startDate").value = startDate.toISOString().substring(0, 10);
            document.getElementById("endDate").value = endDate.toISOString().substring(0, 10);
        }

        // --- Core Salary Generation Logic ---

        async function generateSalarySlip() {
            const selectElement = document.getElementById("teacherSelect");
            const teacherId = selectElement.value;
            const shareInput = document.getElementById("teacherShare");
            const share = parseFloat(shareInput.value) / 100;
            
            if (!teacherId || isNaN(share) || share <= 0 || share > 1) {
                alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ø³ØªØ§Ø° ÙˆØªØ­Ø¯ÙŠØ¯ Ù†Ø³Ø¨Ø© Ø§Ù„Ø£Ø³ØªØ§Ø° (Ø¨ÙŠÙ† 1% Ùˆ 100%) Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.");
                shareInput.focus();
                return;
            }

            const teacherData = JSON.parse(selectElement.options[selectElement.selectedIndex].dataset.teacher);
            const pricePerClass = teacherData.pricePerClass || 0;

            if (pricePerClass === 0) {
                alert("âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§ØªØ¨: ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ 'Ø³Ø¹Ø± Ø§Ù„Ø­ØµØ© Ø§Ù„ÙˆØ§Ø­Ø¯Ø©' Ù„Ù„Ø£Ø³ØªØ§Ø° ÙÙŠ ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø£ÙˆÙ„Ø§Ù‹.");
                return;
            }
            
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            await updatePeriodInfo(); 
            
            // Ù†Ø­ØªØ§Ø¬ Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚ÙŠÙ… Ù…Ù† Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø®ÙÙŠØ©
            const startDateValue = document.getElementById("startDate").value;
            const endDateValue = document.getElementById("endDate").value;
            
            const startDate = new Date(startDateValue);
            // Ù„Ø¶Ù…Ø§Ù† Ø´Ù…ÙˆÙ„ ÙŠÙˆÙ… Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŒ Ù†Ø¶Ø¨Ø· Ø§Ù„ÙˆÙ‚Øª Ø¥Ù„Ù‰ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙŠÙˆÙ… (23:59:59)
            const endDate = new Date(endDateValue);
            endDate.setHours(23, 59, 59, 999);


            let totalRevenue = 0;
            let totalAttendedCount = 0;

            teacherData.students.forEach(student => {
                const sessionsToProcess = [];
                const presentStatus = 'present';

                // 1. Ø¬Ù…Ø¹ Ø§Ù„Ø­ØµØµ Ø§Ù„Ø­Ø§Ø¶Ø±Ø© Ù…Ù† Ø§Ù„Ù€ history
                if (student.history) {
                    student.history.forEach((batch) => {
                        batch.status.forEach((status, index) => {
                            if (status === presentStatus && batch.times && batch.times[index]) {
                                sessionsToProcess.push({
                                    time: new Date(batch.times[index]),
                                    status: status
                                });
                            }
                        });
                    });
                }
                // 2. Ø¬Ù…Ø¹ Ø§Ù„Ø­ØµØµ Ø§Ù„Ø­Ø§Ø¶Ø±Ø© Ù…Ù† Ø§Ù„Ù€ attendance Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                if (student.attendance) {
                    student.attendance.forEach((status, index) => {
                        if (status === presentStatus && student.attendanceTimes && student.attendanceTimes[index]) {
                            sessionsToProcess.push({
                                time: new Date(student.attendanceTimes[index]),
                                status: status
                            });
                        }
                    });
                }
                
                // 3. ÙÙ„ØªØ±Ø© Ø§Ù„Ø­ØµØµ Ø­Ø³Ø¨ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
                sessionsToProcess.forEach(session => {
                    // Ù†Ø³ØªØ®Ø¯Ù… ÙÙ‚Ø· Ø§Ù„Ø­ØµØµ Ø§Ù„ØªÙŠ ÙˆÙ‚Ø¹Øª Ø¨ÙŠÙ† ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…
                    if (session.time >= startDate && session.time <= endDate) {
                        // ** Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯: Ø³Ø¹Ø± Ø§Ù„Ø­ØµØ© Ø§Ù„ÙˆØ§Ø­Ø¯Ø© Ù„ÙƒÙ„ Ø­ØµØ© Ø­Ø¶Ø±Øª **
                        totalRevenue += pricePerClass; 
                        totalAttendedCount++;
                    }
                });
            });

            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ­Ù‚ Ù„Ù„Ø£Ø³ØªØ§Ø° (Ø­ØµØ© Ø§Ù„Ø£Ø³ØªØ§Ø°)
            const teacherSalary = totalRevenue * share;

            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ´Ù Ù„Ù„Ø­ÙØ¸
            generatedSlipData = {
                teacherId: teacherData.id,
                teacherName: teacherData.name,
                subject: teacherData.subject,
                // Ø­ÙØ¸ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ù„Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø· (Ø¨Ø¯ÙˆÙ† ÙˆÙ‚Øª)
                startDate: startDate.toLocaleDateString('ar-DZ'),
                endDate: new Date(endDateValue).toLocaleDateString('ar-DZ'), // Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø¨Ø¯ÙˆÙ† ÙˆÙ‚Øª
                share: share,
                totalRevenue: totalRevenue.toFixed(2),
                totalAttendedCount: totalAttendedCount,
                teacherSalary: teacherSalary.toFixed(2),
                paymentDate: new Date().toISOString(), // Ø­ÙØ¸ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨Ø§Ù„ØµÙŠØºØ© Ø§Ù„Ø¯ÙˆÙ„ÙŠØ© Ù„Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„ÙØ±Ø²
                pricePerClass: pricePerClass
            };
            
            // ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­ØµØµ Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§ØªØ¨
            if (totalAttendedCount === 0) {
                document.getElementById("slip-output").innerHTML = `<p style="text-align: center; color: #777;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­ØµØµ Ù…ÙÙ†Ø¬Ø²Ø© ÙˆÙ…ÙØ¶Ø§ÙØ© Ù„Ù„Ø¥ÙŠØ±Ø§Ø¯ Ø¨ÙŠÙ† ØªØ§Ø±ÙŠØ® ${generatedSlipData.startDate} Ùˆ ${generatedSlipData.endDate}.</p>`;
                document.getElementById("slip-actions").style.display = 'none';
                return;
            }

            // Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ´Ù
            renderSalarySlip(generatedSlipData);
            document.getElementById("slip-actions").style.display = 'flex';
        }

        function renderSalarySlip(data) {
            const output = document.getElementById("slip-output");
            
            output.innerHTML = `
                <div class="slip-header">
                    <h2>ÙƒØ´Ù Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³ØªØ§Ø°</h2>
                    <p>${schoolName}</p>
                </div>
                
                <div class="slip-details">
                    <div><strong>Ø§Ù„Ø£Ø³ØªØ§Ø°:</strong> ${data.teacherName}</div>
                    <div><strong>Ø§Ù„Ù…Ø§Ø¯Ø©:</strong> ${data.subject}</div>
                    <div><strong>Ø§Ù„ÙØªØ±Ø©:</strong> ${data.startDate} - ${data.endDate}</div>
                    <div><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±:</strong> ${new Date().toLocaleDateString('ar-DZ')}</div>
                </div>

                <h3>Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø¥ÙŠØ±Ø§Ø¯</h3>
                <table class="summary-table">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                            <th>Ø§Ù„Ø¹Ø¯Ø¯/Ø§Ù„Ù‚ÙŠÙ…Ø© (Ø¯.Ø¬)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­ØµØ© Ø§Ù„ÙˆØ§Ø­Ø¯Ø© Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©</td>
                            <td>${data.pricePerClass} Ø¯.Ø¬</td>
                        </tr>
                        <tr class="total-row">
                            <td>**Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ø­ØµØµ Ø§Ù„Ø­Ø§Ø¶Ø±Ø© ÙÙŠ Ø§Ù„ÙØªØ±Ø©**</td>
                            <td>**${data.totalAttendedCount} Ø­ØµØ©**</td>
                        </tr>
                        <tr class="total-row">
                            <td>**Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ (Ø§Ù„Ø±Ø¨Ø­ Ù…Ù† Ø§Ù„Ø­ØµØµ)**</td>
                            <td>**${data.totalRevenue} Ø¯.Ø¬**</td>
                        </tr>
                        <tr>
                            <td>Ù†Ø³Ø¨Ø© Ø§Ù„Ø£Ø³ØªØ§Ø° Ø§Ù„Ù…ØªÙÙ‚ Ø¹Ù„ÙŠÙ‡Ø§</td>
                            <td>${(data.share * 100).toFixed(0)}%</td>
                        </tr>
                        <tr class="net-salary-row">
                            <td>**ØµØ§ÙÙŠ Ø§Ù„Ø£Ø¬Ø± Ø§Ù„Ù…Ø³ØªØ­Ù‚ Ù„Ù„Ø£Ø³ØªØ§Ø°**</td>
                            <td>**${data.teacherSalary} Ø¯.Ø¬**</td>
                        </tr>
                    </tbody>
                </table>
                
                <h3>ØªÙˆÙ‚ÙŠØ¹Ø§Øª Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</h3>
                <div class="signature-area">
                    <div class="signature-box">
                        ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø£Ø³ØªØ§Ø° (Ù„Ù„ØªØ£ÙƒÙŠØ¯ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…)
                    </div>
                    <div class="signature-box">
                        ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø¯ÙŠØ± (${managerName})
                    </div>
                </div>
            `;
        }

        // --- Action Functions ---

        // Ø¯Ø§Ù„Ø© Ù…Ø¯Ù…Ø¬Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹ ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØ´Ù
        function saveAndDownloadSlip() {
            if (!generatedSlipData) {
                alert("ÙŠØ±Ø¬Ù‰ ØªÙˆÙ„ÙŠØ¯ ÙƒØ´Ù Ø§Ù„Ø±Ø§ØªØ¨ Ø£ÙˆÙ„Ø§Ù‹.");
                return;
            }
            
            // 1. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹ (Ù†ÙØ³ Ù…Ù†Ø·Ù‚ saveSalarySlip Ø§Ù„Ù‚Ø¯ÙŠÙ…)
            saveSalaryRecord().then(success => {
                if (success) {
                    // 2. ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØ´Ù ÙƒÙ…Ù„Ù
                    downloadSlip();
                    
                    // 3. ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„
                    generatedSlipData = null; 
                    document.getElementById("slip-actions").style.display = 'none';
                    document.getElementById("slip-output").innerHTML = `<p style="text-align: center; color: #777;">ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­. ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø£Ø³ØªØ§Ø° Ø¢Ø®Ø±.</p>`;
                }
            });
        }
        
        // Ø¯Ø§Ù„Ø© Ù…Ù†ÙØµÙ„Ø© Ù„Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„ ÙÙŠ IndexedDB
        function saveSalaryRecord() {
            return new Promise(resolve => {
                // ØªØ­Ù‚Ù‚ Ù†Ù‡Ø§Ø¦ÙŠ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…ØªØ¬Ø± salaries
                if (!db.objectStoreNames.contains("salaries")) {
                    alert("âš ï¸ Ø®Ø·Ø£: Ù…ØªØ¬Ø± 'salaries' ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯. Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­ÙØ¸ Ø§Ù„Ø¯ÙØ¹. ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.");
                    return resolve(false);
                }

                const tx = db.transaction("salaries", "readwrite");
                const store = tx.objectStore("salaries");
                
                const addReq = store.add(generatedSlipData); 
                
                addReq.onsuccess = () => {
                    alert(`ØªÙ… Ø­ÙØ¸ Ø³Ø¬Ù„ Ø§Ù„Ø¯ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­! Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹: ${generatedSlipData.teacherSalary} Ø¯.Ø¬. Ø³ÙŠØªÙ… ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ÙƒØ´Ù Ø§Ù„Ø¢Ù†.`);
                    loadTeachersAndSettings(); // Ù†Ø·Ù„Ø¨ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø§ØªØ°Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø±
                    resolve(true);
                };
                addReq.onerror = (e) => {
                    console.error("Failed to save salary record:", e.target.error);
                    alert("ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø³Ø¬Ù„ Ø§Ù„Ø¯ÙØ¹.");
                    resolve(false);
                };
            });
        }


        // Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„ØªÙ†Ø²ÙŠÙ„ ÙƒØ´Ù Ø§Ù„Ø±Ø§ØªØ¨ ÙƒÙ…Ù„Ù HTML
        function downloadSlip() {
            // Ù†Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙƒØ´Ù Ù…Ù† Ø§Ù„Ø¹Ù†ØµØ± #slip-output
            const slipContent = document.getElementById("slip-output").innerHTML;
            
            // Ù†Ø­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªØ¶Ù…ÙŠÙ† Ø§Ù„Ù€ CSS Ù„ÙŠÙƒÙˆÙ† Ø§Ù„Ù…Ù„Ù Ù‚Ø§Ø¨Ù„Ø§Ù‹ Ù„Ù„Ø¹Ø±Ø¶ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ø¹Ù†Ø¯ ÙØªØ­Ù‡
            const styleContent = document.querySelector('style').innerHTML;
            
            // Ø¨Ù†Ø§Ø¡ Ù…Ù„Ù HTML ÙƒØ§Ù…Ù„
            const htmlContent = `
                <!DOCTYPE html>
                <html lang="ar" dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>ÙƒØ´Ù Ø±Ø§ØªØ¨ ${generatedSlipData.teacherName}</title>
                    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
                    <style>${styleContent}</style>
                    <style>
                        /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù†Ø¯ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ù†ÙØ±Ø¯ */
                        .controls, .action-buttons, button[onclick*="window.location.href"] { display: none !important; }
                        body { background: #fff !important; color: #333 !important; padding: 20px; }
                        .container { 
                            max-width: 800px;
                            margin: 0 auto;
                            box-shadow: none;
                            background: #fff;
                        }
                        #slip-output { border: 1px solid #000; min-height: auto; }
                    </style>
                </head>
                <body>
                    <div class="container">
                        ${slipContent}
                    </div>
                </body>
                </html>
            `;
            
            const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `ÙƒØ´Ù_Ø±Ø§ØªØ¨_${generatedSlipData.teacherName}_${new Date().toLocaleDateString('en-CA')}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function printSlip() {
            if (!generatedSlipData) {
                alert("ÙŠØ±Ø¬Ù‰ ØªÙˆÙ„ÙŠØ¯ ÙƒØ´Ù Ø§Ù„Ø±Ø§ØªØ¨ Ø£ÙˆÙ„Ø§Ù‹.");
                return;
            }
            
            // ØªØ³ØªØ®Ø¯Ù… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø®Ø§ØµÙŠØ© @media print ÙÙŠ CSS Ù„Ø¥Ø®ÙØ§Ø¡ Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ…
            window.print();
        }

    </script>
</body>
</html>
